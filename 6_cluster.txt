---
минимальное кол-во серверов для отказоустойчивости,
и выбор операционных систем для них:

nginx balancer for iis	- 1 сервер, OS Ubuntu 22
iis			- 2 сервера, OS Windows server 2022
	
mssql кластер 		- 3 сервера, OS Windows server 2022
	
doker swarm кластер 	- 3 сервера, OS Ubuntu 22
	
haproxy + Keepalived balancer for pg - 1 сервер, OS Ubuntu 22	
pg + etcd + patroni	- 3 сервера, OS Ubuntu 22
	
mongo сервера в кластере -3 сервера, OS Ubuntu 22

итого 16 серверов

---
за счет чего обеспечивается отказоустойчивость различных компонентов системы 
(как баз данных, так и приложений);
---

1) трафик приходящий на IIS балансируется с помощью nginx,
при падении 1-го сервера IIS, трафик будет продолжать приходить на 2-ой сервер

2) дальше идёт mssql кластер - 3 сервера

3) doker swarm кластер - 3 сервера
отказоустойчивость обеспечивается за счёт того, что swarm проверяет healthcheck контейнеров 
при "падении" контейнера, будет произведена замена.
Docker в режиме swarm не просто отслеживает жизненное состояние контейнера, 
но и в случае перехода в состояние unhealthy попытается пересоздать контейнер.

4) pg кластер 3 сервера , haproxy + Keepalived 1 сервер

хорошая статья https://habr.com/ru/companies/orion_soft/articles/838566/

трафик приходящий на pg кластер 
попадает на единый кластерный IP - созданный через Keepalived

балансируется с помощью haproxy
pg кластер
связка:
etcd + patroni + pg

отказоустойчивость:
patroni отслеживает состяние реплик pg
master - slave - slave
если один из серверов ляжет, будут перевыборы по ролям


5) mongo кластер - 3 сервера



---
схема
https://drive.google.com/file/d/1eGyz8osNEIpxSn35BbTXiMeaMcbrq41j/view


p.s. для отказоустойчивости nginx можно добавить Keepalived 
тогда будет ещё + 2 сервера
